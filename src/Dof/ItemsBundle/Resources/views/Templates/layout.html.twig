{% trans_default_domain 'item' %}

{% autoescape  %}
{% if display != 'modal' %}
<div class="panel panel-default item">
    <div class="panel-heading">
        <h3 class="panel-title">
            {% block name %}
                {{ itemTemplate.getName(locales()) }}
            {% endblock %}
            <font size="2">{{ 'level' | trans({'%level%': itemTemplate.level})}}</font>
            <span class="pull-right">{{ itemTemplate.type.getName(locales()) }}</span>
        </h3>
    </div>
    <div class="panel-body">
        {% endif %}
        <div class="row">
            {# Left column #}
            <div class="col-sm-3">
                <a href="{{ path('dof_items_show', {'slug': itemTemplate.slug}) }}" class="thumbnail">
                    <img class="img-responsive" src="{{ (itemTemplate.webPath) ? asset(itemTemplate.webPath) : asset('bundles/dofitems/img/default.png') }}" alt="{{ itemTemplate.getName(locales()) }}">
                </a>
                <div class="text-center">
                    <p>
                        {% if itemTemplate.preliminary %}
                            <span class="label label-danger">Bêta</span>
                        {% endif %}
                        {% if itemTemplate.release != 1 %}
                            <span class="label label-default hidden-xs">{{ itemTemplate.release }}</span>
                        {% endif %}
                    </p>

                    {% block bonus %}
                    {% endblock %}

                    {% if is_granted('ROLE_SUPER_ADMIN') and not itemTemplate.preliminary and itemTemplate.visible %}
                    <p>
                        <a target="_blank" href="http://www.dofus.com/fr/mmorpg/encyclopedie/equipements/{{ itemTemplate.id }}-{{ itemTemplate.nameFr | slugify }}">
                            <img src="{{ asset('bundles/dofmain/images/dof_logo_little.png') }}" />
                        </a>
                    </p>
                    {% endif %}

                    {% block left_menu %}
                    {% endblock %}

                </div>
            </div>

            {# Right column #}
            <div class="col-sm-9">
                {% set item_content = '' %}
                {# Menu tabs #}
                <ul class="nav nav-pills" role="tablist">
                    {% set isActivedTab = false %}

                    {# Effets #}
                    {% set characts %}
                        {% include 'DofItemsBundle::characteristics.html.twig' with {'item': item, 'updatable': type == 'build' and can_write | default(false)} %}
                    {% endset %}
                    {% if characts | trim is not empty %}
                        {% set isActiveTab = true %}
                        <li class="active"><a href="#caracts-item{{ item.id }}" role="tab" data-toggle="tab">Effets</a></li>
                    {% endif %}

                    {# Recette #}
                    {% if itemTemplate.components is not empty %}
                        <li><a {% if not isActivedTab %}class="active" {% endif %}href="#recipe-item{{ item.id }}" role="tab" data-toggle="tab">Recette</a></li>
                    {% endif %}

                    {% block tabs_menu %}
                    {% endblock %}

            </ul>
            <div class="tab-content">
                {# Effets #}
                {% if characts | trim is not empty %}
                <div class="tab-pane active" id="caracts-item{{ item.id }}">
                    {{ characts }}
                </div>
                {% endif %}

                {# Recette #}
                {% if itemTemplate.components is not empty %}
                <div class="tab-pane" id="recipe-item{{ item.id }}">
                    {% for component in itemTemplate.components %}
                    <a href="{{ path('dof_items_show', {'slug': component.component.slug}) }}">
                        {{ component.component.getName(locales()) }}
                    </a>
                    x {{ component.quantity }}
                    <br />
                    {% endfor %}
                </div>
                {% endif %}

                {% block tabs_content %}
                {% endblock %}
            </div>

            {# Close right column #}
        </div>
    </div>
    <hr />
    {% if itemTemplate.equipment and itemTemplate.set is not null %}
    <strong>
        <a href="{{ path('dof_set_show', {'slug': itemTemplate.set.slug}) }}">
            {{ itemTemplate.set.getName(locales()) }}
        </a>
    </strong>
    <br />
    {% endif %}
    {% if itemTemplate.description == '#1' %}
        Arme éthérée
    {% else %}
        {{ itemTemplate.getDescription(locales()) }}
    {% endif %}

    {% if slugs is defined and slugs is not empty %}
    <hr />
    <form class="form-horizontal" method="POST" action="{{ path('dof_build_additem_post') }}">
        <input name="stuff" type="hidden" value="{{ slugs.stuff }}">
        <input name="useSlot" value="1" type="hidden" />
        <input name="items[{{ slot_number | default(0) }}]" type="hidden" value="{{ itemTemplate.id }}">

        <div class="col-lg-offset-3 col-lg-6">
            <div class="form-group">
                <label for="percent{{ itemTemplate.id }}" class="col-sm-2 control-label">Qualité</label>
                <div class="col-sm-10">
                    <div class="input-group">
                        <input class="form-control" id="percent{{ itemTemplate.id }}" type="number" name="percent" value="85" step="5" min="0" max="100">
                        <span class="input-group-addon">%</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-primary">Equiper</button>
                </div>
            </div>
        </div>
    </form>
    {% endif %}
    {% if is_granted('ROLE_SUPER_ADMIN') %}
    <hr />
    <div class="text-center">
        <a class="btn btn-default" href="{{ path('admin_dof_items_itemtemplate_edit', {'id': itemTemplate.id}) }}">
            Editer (Admin)
        </a>
        <a class="btn btn-default" href="{{ path('dof_items_addskin', {'id': itemTemplate.id}) }}">
            Ajouter image
        </a>
    </div>
    {% endif %}

    {% if display != 'modal' %}
</div>
</div>
{% endif %}
{% endautoescape %}
