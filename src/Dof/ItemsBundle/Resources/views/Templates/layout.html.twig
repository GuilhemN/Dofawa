{% trans_default_domain 'item' %}

{% autoescape  %}
{% if display != 'modal' %}
<div class="panel panel-default item">
    <div class="panel-heading">
        <h3 class="panel-title">
            {% block name %}
                {{ itemTemplate.getName(locales()) }}
            {% endblock %}
            <font size="2">{{ 'level' | trans({'%level%': itemTemplate.level}) }}</font>
            <span class="pull-right">{{ itemTemplate.type.getName(locales()) }}</span>
        </h3>
    </div>
    <div class="panel-body">
        {% endif %}
        <div class="row">
            {# Left column #}
            <div class="col-sm-3">
                <a href="{{ path('dof_items_show', {'slug': itemTemplate.slug}) }}" class="thumbnail">
                    <img class="img-responsive" src="{{ (itemTemplate.webPath) ? asset(itemTemplate.webPath) : asset('bundles/dofitems/img/default.png') }}" alt="{{ itemTemplate.getName(locales()) }}">
                </a>
                <div class="text-center">
                    <p>
                        {% if itemTemplate.deprecated %}
                            <span class="label label-danger hidden-xs">Obsolète</span>
                        {% endif %}
                        {% if itemTemplate.preliminary %}
                            <span class="label label-warning">Bêta</span>
                        {% endif %}
                        {% if itemTemplate.release != 1 %}
                            <span class="label label-info hidden-xs">{{ itemTemplate.release }}</span>
                        {% endif %}
                    </p>

                    {% block bonus %}
                    {% endblock %}

                    {% if is_granted('ROLE_SUPER_ADMIN') %}
                    <hr />
                    <p>
                        {% if not itemTemplate.preliminary and itemTemplate.visible %}
                        <a class="glyphicon glyphicon-link" target="_blank" href="http://www.dofus.com/fr/mmorpg/encyclopedie/equipements/{{ itemTemplate.id }}-{{ itemTemplate.nameFr | slugify }}"></a>
                        {% endif %}
                        <a class="glyphicon glyphicon-edit" href="{{ path('admin_dof_items_itemtemplate_edit', {'id': itemTemplate.id}) }}"></a>
                        <a class="glyphicon glyphicon-camera" href="{{ path('dof_items_addskin', {'id': itemTemplate.id}) }}"></a>
                    </p>
                    {% endif %}

                    {% block left_menu %}
                    {% endblock %}

                </div>
            </div>

            {# Right column #}
            <div class="col-sm-9">
                {# Menu tabs #}
                <ul class="nav nav-pills" role="tablist">
                    {% set characts %}
                        {% include 'DofItemsBundle::characteristics.html.twig' with {'item': item, 'updatable': type == 'build' and can_write | default(false)} %}
                    {% endset %}
                    {% set criteria %}
                        {% include 'DofItemsBundle::criteria.html.twig' with {'criterion': itemTemplate.treatedCriteria} %}
                    {% endset %}

                    {% block tabs_menu %}
                        {% set is_active_tab = false %}
                        {# Effets #}
                        {% if characts | trim is not empty %}
                            {% set is_active_tab = true %}
                            <li class="active">
                                <a href="#caracts-item{{ item.id }}" role="tab" data-toggle="tab">
                                    {{ 'tabs.effects' | trans() }}
                                </a>
                            </li>
                        {% endif %}

                        {# Recette #}
                        {% if itemTemplate.components is not empty %}
                        <li{% if not is_active_tab %}{% set is_active_tab = true %} class="active"{% endif %}>
                            <a href="#recipe-item{{ item.id }}" role="tab" data-toggle="tab">
                                {{ 'tabs.recipe' | trans() }}
                            </a>
                        </li>
                        {% endif %}

                        {# Conditions #}
                        {% if criteria | trim is not empty %}
                            <li{% if not is_active_tab %}{% set is_active_tab = true %} class="active"{% endif %}>
                                <a href="#criteria-item{{ item.id }}" role="tab" data-toggle="tab">
                                    {{ 'tabs.conditions' | trans() }}
                                </a>
                            </li>
                        {% endif %}

                        {# Drops #}
                        {% if itemTemplate.drops is not empty %}
                            <li{% if not is_active_tab %}{% set is_active_tab = true %} class="active"{% endif %}>
                                <a href="#drops-item{{ item.id }}" role="tab" data-toggle="tab">
                                    Drop sur
                                </a>
                            </li>
                        {% endif %}

                        {# Drops #}
                        {% if itemTemplate.compounds is not empty %}
                        <li{% if not is_active_tab %}{% set is_active_tab = true %} class="active"{% endif %}>
                            <a href="#compounds-item{{ item.id }}" role="tab" data-toggle="tab">
                                Dans la recette de
                            </a>
                        </li>
                        {% endif %}
                    {% endblock %}

                </ul>
                <div class="tab-content">
                    {% block tabs_content %}
                        {% set is_active_tab = false %}
                        {# Effets #}
                        {% if characts | trim is not empty %}
                        {% set is_active_tab = true %}
                        <div class="tab-pane active" id="caracts-item{{ item.id }}">
                            {{ characts }}
                        </div>
                        {% endif %}

                        {# Recette #}
                        {% if itemTemplate.components is not empty %}
                        <div class="tab-pane{% if not is_active_tab %}{% set is_active_tab = true %} active{% endif %}" id="recipe-item{{ item.id }}">
                            {% for component in itemTemplate.components %}
                            <a href="{{ path('dof_items_show', {'slug': component.component.slug}) }}">
                                {{ component.component.getName(locales()) }}
                            </a>
                            x {{ component.quantity }}
                            <br />
                            {% endfor %}
                        </div>
                        {% endif %}

                        {# Conditions #}
                        {% if criteria | trim is not empty %}
                        <div class="tab-pane{% if not is_active_tab %}{% set is_active_tab = true %} active{% endif %}" id="criteria-item{{ item.id }}">
                            <ul class="list-unstyled">
                                {{ criteria }}
                            </ul>
                        </div>
                        {% endif %}

                        {# Drops #}
                        {% if itemTemplate.drops is not empty %}
                        <div class="tab-pane{% if not is_active_tab %}{% set is_active_tab = true %} active{% endif %}" id="drops-item{{ item.id }}">
                            {% for drop in itemTemplate.drops %}
                                <a href="{{ path('dof_monster_show', {'slug': drop.monster.slug}) }}">
                                    {{ drop.monster.getName(locales()) }}
                                </a>
                                <br/>
                            {% endfor %}
                        </div>
                        {% endif %}

                        {# Compounds #}
                        {% if itemTemplate.compounds is not empty %}
                        <div class="tab-pane{% if not is_active_tab %}{% set is_active_tab = true %} active{% endif %}" id="compounds-item{{ item.id }}">
                            {% for compound in itemTemplate.compounds %}
                            <a href="{{ path('dof_items_show', {'slug': compound.compound.slug}) }}">
                                {{ compound.compound.getName(locales()) }}
                            </a>
                            <br/>
                            {% endfor %}
                        </div>
                        {% endif %}
                    {% endblock %}
                </div>

            {# Close right column #}
            </div>
        {% set descriptionCriteria = block('tabs_menu') | trim is empty %}
        {% if not descriptionCriteria %}
        </div>
        {% endif %}
        <div>
            <hr />
            {% block footer %}
            {% endblock %}

            {% if itemTemplate.description == '#1' %}
                Arme éthérée
            {% else %}
                {{ itemTemplate.getDescription(locales()) }}
            {% endif %}
        </div>
        {% if descriptionCriteria %}
        </div>
        {% endif %}

        {% block more %}
        {% endblock %}

        {% if display != 'modal' %}
    </div>
</div>
{% endif %}
{% endautoescape %}
