{% extends '::layout.html.twig' %}

{% block breadcrumb %}
	{{ parent() }}
	<li><a href="{{ path('dof_items_manager_homepage') }}">{{ 'inventory'|trans({}, 'generalTrans') }}</a></li><li>Familiers</li>
{% endblock %}

{% block body %}
{% autoescape %}
	<h3>Gestionaire de familiers</h3>

    <div class="panel panel-default">
        <div class="panel-heading">Familiers</div>
        <form method="POST" name="feedPets" action="{{ path('dof_items_manager_pets_feed') }}">
            <table class="table">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Dernier repas</th>
                        <th>Prochain repas</th>
                        <th>Nourrir</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for pet in pets %}
                        {% set hourMax = '+' ~ pet.itemTemplate.maxFeedInterval ~ ' hour' %}
                        <tr {% if pet.lastMeal is not null and date(pet.nextMeal) > date() %}
                                    class="success"
                                {% elseif pet.lastMeal is not null and (date(pet.nextMeal) < date() and date(pet.lastMeal | date_modify(hourMax)) > date() ) %}
                                    class="warning"
                                {% else %}
                                    class="danger"
                                {% endif %}>
                            <td>

                                {% if pet.name is not null %}
                                    {{ pet.name }}({{ pet.itemTemplate.getName(locales()) }})
                                {% else %}
                                    {{ pet.itemTemplate.getName(locales()) }}
                                {% endif %}
                            </td>
                            <td>
                                {% if pet.lastMeal is not null %}
                                    {{ pet.lastMeal  | date_format }}
                                {% else %}
                                    Jamais!
                                {% endif %}
                            </td>
                            <td>
                                {% if pet.lastMeal is not null %}

                                    {{ pet.nextMeal | date("d/m/y H:i:s") }}
                                {% else %}
                                    Jamais!
                                {% endif %}
                            </td>
                            <td>
                                <input type="checkbox"  name="pets[]" value="{{ pet.id }}" value="">
                            </td>
                            <td>
                                <a href="{{ path('dof_items_manager_pets_del', {id: pet.id}) }}"><span class="glyphicon glyphicon-remove"></span></a>
                            </td>
                        </tr>
                    {% else %}
                    	<tr>
                            <td></td> <td>Pas encore de familier dans le gestionnaire!</td><td></td><td></td><td></td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button type="submit" class="btn btn-primary">Nourrir</button>
        </form>
    </div>
{% endautoescape %}
{% endblock %}
